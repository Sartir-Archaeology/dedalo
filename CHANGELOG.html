<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
	<meta charset="utf-8"/>
</head>
<body>

<h1 id="6.2.3-2024-06-07">[6.2.3] - 2024&#8211;06&#8211;07</h1>

<ul>
<li>This version added an optional OCR process to PDF files, now is possible to install OCR library to process every uploaded PDF. See the <code>sample_config.php</code> and documentation to install and configure this new option. Thanks to @pricua for his indicative and implement this feature.</li>
<li>The Thesaurus of Conservation has been changed to Restoration.</li>
</ul>

<h2 id="bugfixes">Bug Fixes</h2>

<ul>
<li>[<strong>breaking</strong>] Fix component_portal &#8216;add_component_info&#8217; calculation error where &#8216;ddinfo&#8217; was not found when no previous data already exists.</li>
<li>[<strong>breaking</strong>] Fix component_portal search error where some request config are not resolved correctly in search mode</li>
<li>[<strong>breaking</strong>] Fix common::get_ar_request_config error where components in tm mode (time machine) are using &#8216;default&#8217; switch mode instead the expected: &#8216;list&#8217;</li>
<li>Fix user search incorrect filter locator passed as array instead expected object</li>
<li>Fix get_columns_map errors where in search mode, term was not displayed</li>
<li>Fix keyup event issue where transcription field (text area editor) was blur on user key press ESC</li>
<li>Fix paginator missing vars page_row_begin, page_row_end in non defined label situations</li>
<li>Fix CSS issues on component_av and component_portal list views</li>
<li>Fix wrong URL from widget media_icons</li>
<li>Fix dd_grid get_record_link_column issue where &#8216;session_save = false&#8217; was missing in URL</li>
<li>Fix component_image issue where image_container.object_node fails on fit_image. Now is checked before apply changes for safe</li>
<li>Fix active_fill_color error on vector_editor where null active_fill_color crash the application</li>
<li>Fix service_time_machine CSS issue where images from non component_text_area were set to 1rem in height</li>
<li>Fix section CSS issues in time_machine service</li>
<li>Fix bug where component properties CSS was applied into tool_time_machine list</li>
<li>Fix service_time_machine CSS issue where images in the mosaic portal were displayed too large</li>
<li>Fix modal iframe height issue where scrollbars are displayed incorrectly because wrong height definitions</li>
<li>Fix tool_propagate_component_data issue where change_data was not properly set before save to tmp section</li>
<li>Fix component_text_area issue where focus editor fails if ckeditor is not already initialized</li>
<li>Fix errors in start sequence client page where unavailable PHP or PostgreSQL servers were not managed properly</li>
<li>Fix page index environment js file path error</li>
<li>Fix process_uploaded_file issue where empty argument &#8216;process_options&#8217; generates an error. Fixed both arguments to default value of null for compatibility with current tools (like tool_leaflet_special_tools)</li>
<li>Add missing &#8216;mosaic&#8217; view definition to component_portal in list mode render</li>
<li>Removed double instantiation of tools.</li>
<li>Remove double JSON encode q value in get_hierarchy_sections_from_types</li>
<li>Service dropzone info node name</li>
<li>Service dropzone global_progress status set to 100% when previous uploads was done. Now the global_progress is reset to 0% when new file is added or when the queue is done.</li>
<li>Set extracted text data as array previously to save for the PDF in the text processing</li>
</ul>

<h2 id="documentation">Documentation</h2>

<ul>
<li>Change the Conservation thesaurus to Restoration names and tlds in documentation.</li>
<li>Change the example of file in tool_import_csv</li>
<li>Add OCR optional install and configuration documentation</li>
</ul>

<h2 id="features">Features</h2>

<ul>
<li>Add children_search when the thesaurus call to flat sections as rsc197 (People under study)</li>
<li>Added get_hierarchy_tld method in hierarchy, call to the hierarchy1 with the specific section_id to obtain his tld.</li>
<li>Added delete_virtual_section method in hierarchy, to delete all ontology definitions from the specified tld</li>
<li>Add to clone the property definition of the real_section when tool_hierarchy create new virtual section, is necessary to get the original properties to use rqo or sqo definitions</li>
<li>Added force_to_create option into the tool_hierarchy, to remove previous definition and recreate the virtual section with the changes.</li>
<li>Add component_image regenerate_component option to check and fix SVG file path</li>
<li>Add to get the tool_config of specific tool or his default definition.</li>
<li>Added an overwrite the config defined by ontology with the default or specific tool_config. Implemented for the buttons and components context.</li>
</ul>

<h2 id="miscellaneoustasks">Miscellaneous Tasks</h2>

<ul>
<li>Improve service autocomplete autocomplete_data_li CSS line-height</li>
<li>Add to change peri1 section to dc1 section to unify thesaurus tlds</li>
<li>Update composer files (autoload, etc.)</li>
<li>Add search thesaurus &#8216;children_search&#8217; for People section case (rsc197 from hierarchy1)</li>
<li>First change of the duplicated SQL search, is not operative!</li>
<li>Add vector_editor missing stopPropagation for click events</li>
<li>Add &#8216;get_structure_context_simple&#8217; to tool_common for consistency with common calls</li>
<li>Add $add_request_config===true clause to ar_target_section_ddo calculation in common::get_structure_context to prevent calculate target-sections and their request config when the function call explicit set add_request_config = false</li>
<li>Add view_tool_time_machine_list class name &#8216;mode&#8217;</li>
<li>Add &#8216;Invalid tipo&#8217; error to start sequence from API when received tipo model cannot be resolved</li>
<li>Prepare API environment for future calls</li>
</ul>

<h2 id="refactor">Refactor</h2>

<ul>
<li>[<strong>breaking</strong>] Refactor core function &#8216;session_start_manager&#8217; for easy debug</li>
<li>[<strong>breaking</strong>] Refactor environment.js.php for easy debug</li>
<li>[<strong>breaking</strong>] Unify dd_core_api::start calls to use &#8216;get_structure_context_simple&#8217; instead of the (more expensive) &#8216;get_structure_context&#8217;.</li>
<li>Change the SQL to use to find duplicates, now it use a HAVING clause and the window return the id in the same way that other searches.</li>
<li>Unify open viewer in media components (3d, av, image, pdf, svg). Implement media common handler for this</li>
<li>Service dropzone with more sense class names</li>
<li>Add process_options to component_3d, component_av, component_image, component_json, component_svg and component_media_common process_uploaded_file</li>
<li>Unify the process of OCR to PDF files as process options flow</li>
</ul>

<h2 id="change">Change</h2>

<ul>
<li>Update main index.html CSS cachebust</li>
<li>Remove environment display_errors = 0 (environment errors are useful in some situations)</li>
<li>Remove common-&gt;get_json debug duplicated data properties</li>
<li>Add new label into tool_lang_multi to use his own label definition</li>
<li>Replace Spanish label with English label in render paginator</li>
<li>Change default display_json value for some render stream process</li>
<li>Add check if the term has children when the caller is a hierarchy of a flat section as rsc197(people under study)</li>
<li>Add target_section_tipo to the get_children API call from ts_object</li>
<li>Add check if the ts_object have children to change the style of the arrow</li>
<li>Update the register file of tool_hierarchy to include new labels and translations</li>
<li>Add pagination total to get_children_data on children_search</li>
<li>Add filter of not null values to find duplicates.</li>
<li>Add common var $buttons_context, used to store calculated buttons context value</li>
<li>Add &#8216;set_permissions&#8217; to get_structure_context_simple to prevent calculate context permissions in simple mode</li>
<li>Move set_dato_default permissions check to the end of the function to prevent unnecessary permissions calculation on set_dato_default</li>
<li>Add active_component_instance to tool_hierarchy</li>
<li>Set the default limit to get thesaurus terms, set with 300</li>
<li>Change default DEDALO_ROOT_WEB for CLI as &#8216;/dedalo&#8217; instead &#8216;/&#8217; (solve path problems using processes)</li>
<li>Add caller_options to set the section caller and the component/button caller to the tools. implemented in tool_common</li>
<li>Change the restoration hierarchies definition in hierarchies</li>
<li>Add to get 2 characters in the name of the files into the tool_import_file. Now the regex could get 2 letter for the field definition.</li>
<li>Add tool_common.open_tool options to receive options.tool_context as string such as &#8216;tool_upload&#8217; and calculate tool context by itself</li>
<li>Change component_3d file name from view_column_list_3d to view_default_list_3d</li>
<li>Homogenise media_wrapper CSS image components</li>
<li>Upgrade dropzone to v7.1.2 from the fork: https://github.com/NicolasCARPi/dropzone</li>
<li>Show the log of the process only when the show debug is active</li>
<li>Remove the min-with of the service autocomplete in small screens</li>
<li>Change the flex-direction of the service tmp section in small screens</li>
<li>Re style CSS of the tool_import_files and create new layout for small screens</li>
<li>Add to set the destination field when an image is dropped in the tool import files. Now if the control field is active the image dropped will be assign to the correct field.</li>
<li>Set the regex of tool import files to get the field name with 1 or 2 characters. Now the files can set the field control with 2 letters as my_file-An.jpg</li>
<li>Add cache to get the tools config. Now if the tool has been resolved it will returned directly without calling the DDBB</li>
<li>Add modal close action re-select the caller component for easy user</li>
<li>Style the OCR options in tool_upload</li>
<li>Enforce the shell command for OCR processing PDF files</li>
<li>Remove PHPUnit function from component_pdf</li>
<li>Change the typology 10 name from Conservation to Restoration</li>
<li>Check if the data and value is set for render view mini of component_number</li>
<li>Check if is set fields_separator else use the default. Changed in component_number and component_input text render edit.</li>
</ul>

</body>
</html>

