import{data_manager}from"../../../core/common/js/data_manager.js";import{get_instance,delete_instance}from"../../../core/common/js/instances.js";import{common}from"../../../core/common/js/common.js";import{ui}from"../../../core/common/js/ui.js";import{tool_common}from"../../tool_common/js/tool_common.js";import{render_tool_tc,add_component}from"./render_tool_tc.js";export const tool_tc=function(){return this.id,this.model,this.mode,this.node,this.ar_instances,this.status,this.events_tokens,this.type,this.source_lang,this.langs,this.caller,!0};tool_tc.prototype.render=common.prototype.render,tool_tc.prototype.destroy=common.prototype.destroy,tool_tc.prototype.edit=render_tool_tc.prototype.edit,tool_tc.prototype.init=async function(t){return this.trigger_url=DEDALO_TOOLS_URL+"/tool_tc/trigger.tool_tc.php",this.lang=t.lang,this.langs=page_globals.dedalo_projects_default_langs,this.source_lang=t.caller.lang,tool_common.prototype.init.call(this,t)},tool_tc.prototype.build=async function(t=!1){return tool_common.prototype.build.call(this,t)},tool_tc.prototype.load_component=async function(t){const o=this,e=o.caller,n=JSON.parse(JSON.stringify(e.context));n.lang=t;const r=await get_instance({model:e.model,tipo:e.tipo,section_tipo:e.section_tipo,section_id:e.section_id,mode:"edit_in_list"===e.mode?"edit":e.mode,lang:t,section_lang:e.lang,type:e.type,context:n,data:{value:[]},datum:e.datum});r.caller=this,await r.build(!0);const s=o.ar_instances.find(t=>t===r);return r!==o.caller&&void 0===s&&o.ar_instances.push(r),r},tool_tc.prototype.change_all_time_codes=async function(t){return!1},tool_tc.prototype.add_time_code_offset=function(t,o){const e=(t=t.replace("[TC_","").replace("_TC]","")).split(":"),n=e[2].split("."),r=e[0]?Number(e[0]):0,s=e[1]?Number(e[1]):0,i=n[0]?Number(n[0]):0,c=n[1]?n[1]:0,a=3600*r+60*s+i+Number(o),l=parseInt(a/3600),_=parseInt(a%3600/60),m=a-(3600*l+60*_);return"[TC_".concat(l.toString().padStart(2,"0"),":",_.toString().padStart(2,"0"),":",m.toString().padStart(2,"0"),".",c,"_TC]")},tool_tc.prototype.add_and_save_time_code_offset=async function(t,o){if(!confirm(get_label.seguro))return!1;const e=document.getElementById("tc_lang"),n={url:this.trigger_url,mode:"change_all_timecodes",component_tipo:this.caller.tipo,section_tipo:this.caller.section_tipo,section_id:this.caller.section_id,lang:e.value,offset_seconds:o},r=await fetch(this.trigger_url,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify(n)}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then(t=>t.json()).catch(t=>(console.error("!!!!! REQUEST ERROR: ",t),{result:!1,msg:t.message,error:t})),s=!1===r.result?"error":"ok";ui.show_message(t,r.msg,s,"response_div",!0);const i=this.node[0].querySelector(".target_component_container");return add_component(this,i,e.value),!0===SHOW_DEBUG&&console.log("trigger_response:",r),console.log("trigger_response:",r),r};