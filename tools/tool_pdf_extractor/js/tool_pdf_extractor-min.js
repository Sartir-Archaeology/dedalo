import{data_manager}from"../../../core/common/js/data_manager.js";import{get_instance,delete_instance}from"../../../core/common/js/instances.js";import{common}from"../../../core/common/js/common.js";import{tool_common}from"../../tool_common/js/tool_common.js";import{render_tool_pdf_extractor}from"./render_tool_pdf_extractor.js";export const tool_pdf_extractor=function(){return this.id,this.model,this.mode,this.node,this.ar_instances,this.status,this.events_tokens,this.type,this.caller,!0};tool_pdf_extractor.prototype.render=common.prototype.render,tool_pdf_extractor.prototype.destroy=common.prototype.destroy,tool_pdf_extractor.prototype.edit=render_tool_pdf_extractor.prototype.edit,tool_pdf_extractor.prototype.init=async function(t){this.trigger_url=DEDALO_TOOLS_URL+"/tool_pdf_extractor/trigger.tool_pdf_extractor.php";const o=tool_common.prototype.init.call(this,t),e=this.caller.data.value[0].offset;return this.config={method:"text_engine",page_in:!1,page_out:!1,offset:e},o},tool_pdf_extractor.prototype.build=async function(t=!1){return tool_common.prototype.build.call(this,t)},tool_pdf_extractor.prototype.get_pdf_data=async function(t){const o={component_tipo:t.caller.tipo,section_id:t.caller.section_id,section_tipo:t.caller.section_tipo};return(await fetch(t.trigger_url,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify({mode:"get_pdf_data",extractor_config:t.config,component:o})}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then(t=>t.json()).catch(t=>(console.error("!!!!! REQUEST ERROR: ",t),{result:!1,msg:t.message,error:t}))).result},tool_pdf_extractor.prototype.process_pdf_data=async function(t){const o=this.config.offset,e=!1===this.config.page_in||""===this.config.page_in||void 0===this.config.page_in?1:parseInt(this.config.page_in);let r="";switch(this.config.method){case"text_engine":const n=t.split("\f"),c=n.length-1;for(let t=0;t<c;t++){r+=`<hr>[page-n-${t+e}-${t+e-1+o}-data:[${t+e}]:data]<br>`+(n[t]+"").replace(/(\r\n|\n\r|\r|\n)/g,"<br>$1")}break;case"html_engine":const i=(new DOMParser).parseFromString(t,"text/html").body,a=i.querySelectorAll("a[name]"),s=a.length;for(let t=0;t<s;t++){const e=a[t].name,n=`[page-n-${e}-${e-1+o}-data:[${e}]:data]<br>`,c=document.createTextNode(n);a[t].parentNode.replaceChild(c,a[t]),r=i.innerHTML}}return r};