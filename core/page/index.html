<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width">
	<link rel="shortcut icon" href="../../favicon.ico" />
	<title>DÃ©dalo Management System</title>
	<meta charset="utf-8">
	<style type="text/css">
		.loading {
			opacity: 0.4;
			pointer-events: none !important;
			-webkit-user-select: none !important;
			-khtml-user-select: none !important;
			-moz-user-select: none !important;
			-o-user-select: none !important;
			user-select: none !important;
			/*transition: opacity 0.25s*/
		}
		.hide {
			display: none !important;
		}
		.invisible {
			visibility: hidden !important;
			opacity: 0 !important;
			height: 0 !important;
			width: 0 !important;
			padding: 0!important;
			margin: 0!important;
		}
	</style>
	<link rel="stylesheet" type="text/css" href="../page/css/main.css">
	<script defer="defer" src="../common/js/environment.js.php"></script>
	<script defer="defer" src="../../lib/tinymce/js/tinymce/tinymce.min.js"></script>
</head>
<body>
	<div id="main" class="hide"></div>
	<div id="debug" class="debug hide"></div>

	<script type="module">
		const t0 = performance.now()

		// page instance
		import {data_manager} from '../common/js/data_manager.js'
		import {get_instance} from '../common/js/instances.js'
		import {dd_console, url_vars_to_object} from '../common/js/utils/index.js'
		import {common} from '../common/js/common.js'
		import '../common/js/dd-modal.js'
		import {page} from '../page/js/page.js'
		import {login} from '../login/js/login.js'
		( async () => {

			// main CSS add loading
				const main = document.getElementById("main")
					  main.classList.add("loading")

			// start bootstrap
				const rqo = { // rqo (request query object)
					action			: 'start',
					search_obj		: url_vars_to_object(location.search),
					prevent_lock	: true
				}
				const api_response = await data_manager.prototype.request({
					body : rqo
				})
				console.log("+++ start api_response:",api_response);

			// error case
				if (api_response.result===false) {
					main.innerHTML = api_response.msg;
					main.classList.remove("loading","hide")
					return
				}

			// page instance
				const page = await get_instance({
					model	: 'page',
					context	: api_response.result
				});

			// page instance build and render
				const build			= await page.build()
				const wrapper_page	= await page.render()

			// main. Add node and restore class
				main.appendChild(wrapper_page)
				main.classList.remove("loading","hide")

			// debug
				if(SHOW_DEBUG===true) {
					// console.log("%c + Page instantiated and rendered total (ms): ", 'background: #000000; color: violet', performance.now()-t0 )
					dd_console(`__Time to Page init, build and render: ${Math.round(performance.now()-t0)} ms`)
				}
		})()
	</script>
</body>
</html>