<?php

	# VISUALIZADOR HTML
	print "<!-- ".__CLASS__." -->";
	print "<div class=\"css_wrap_rows_search\">";

	
		# CONTENIDO (INPUT)
		$html_content   = '';		


	#
	# DEVELOPMENT 2	- SEARCH2
		js::$ar_url[]  = DEDALO_LIB_BASE_URL."/search/js/search2.js";

		$select_path 		= search_development2::get_search_select_from_section( $this->section_obj );
		$select_path_json 	= json_encode($select_path);

		# Get current search_options 
		# $search_options_id 	 = $section_tipo;
		# $search_options 	 = section_records::get_search_options( $search_options_id );
		#$search_options_json = json_encode($search_options);
		$user_id 	 = navigator::get_user_id();
		$temp_preset = search_development2::get_preset(DEDALO_TEMP_PRESET_SECTION_TIPO, $user_id, $section_tipo);
		$temp_filter = isset($temp_preset->json_filter) ? $temp_preset->json_filter : null;
	
		$init_options  = array(
							"section_tipo" 	=> $section_tipo,
							"temp_filter" 	=> encodeURIComponent($temp_filter)
							);
		$init_options_json = json_encode($init_options, JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP | JSON_HEX_TAG);

		$search2_html = '';


		# Butto to open search2 options
		$search2_html  .= '<div id="open_search2_button" onclick=\'search2.init('.$init_options_json.')\' class="btn btn-default btn-sm button_open_search2">'.label::get_label('filtro').'</div>';
		if(SHOW_DEBUG===true) {
			#$search2_html  .= "<script>window.ready(function(){ search2.init({$init_options_json}) })</script>";
		}
		$search2_html  .= '<div id="search2_global_container" data-select_path="'.encodeURIComponent($select_path_json).'" style="display:none">';

			$search2_html  .= '<button id="button_save_preset" type="button" class="btn btn-danger btn-sm" onclick="search2.save_preset(this)">Preset: '.label::get_label('salvar').' '.label::get_label('cambios').'</button>';			
				
			#
			# FIELDS SELECTOR search2_container_selector. Where section fields list are loaded
				$search2_html  .= "<div id=\"toggle_container_selector\" onclick=\"search2.toggle_fields(this)\">".label::get_label('campos')."</div>";
				$search2_html  .= "<div id=\"search2_container_selector\"> search2_container_selector </div>";

			#
			# CANVAS SELECTION search2_container_selection. Where dragged fields are dragged and stored
				$search2_html  .= "<div id=\"search2_container_selection\">";
				#$search2_html  .= "<h4>Search configuration</h4>";
				# search_group_container
				$search2_html  .= "<div id=\"search_group_container\"></div>";

				$search2_html  .= "</div>";

			#
			# PRESETS SELECTION_PRESETS search2_container_selection_presets. List of stored selection presets
				$search2_html  .= "<div id=\"search2_container_selection_presets\" data-section_tipo=\"$section_tipo\">";
				#$search2_html  .= '<button id="button_save_preset" type="button" class="btn btn-danger btn-sm btn-block" onclick="search2.save_preset(this)">'.label::get_label('salvar').' '.label::get_label('cambios').'</button>';	
				$search2_html  .= "<div class=\"component_presets_label\">";
				$search2_html  .= label::get_label('presets_de_busqueda');
				$search2_html  .= "<span id=\"button_new_preset\" class=\"button_plus\" onclick=\"search2.new_preset(this)\">+</span>";
				$search2_html  .= "</div>";

				# new_preset_div
				$search2_html  .= "<div id=\"new_preset_div\" class=\"div_edit\"></div>";
				# component_presets_list
				$search2_html  .= "<ul id=\"component_presets_list\"><ul>";
				$search2_html  .= "</div>";//end search2_container_selection_presets
				$search2_html  .= "<div id=\"toggle_container_selection_presets\" onclick=\"search2.toggle_presets(this)\"> Presets </div>";

		$search2_html  .= "</div>";//end search2_global_container

		// Add to page
		$html_content .= $search2_html;



		/*
		$html_content  .= " <div class=\"tab_title css_rows_search_tap\" data-tab_id=\"filter_tap\"> ".label::get_label('filtro')."</div>";

		switch(true) {

			case $permissions==0:
				$html_content .= " <span class=\"css_span_dato\"> ".label::get_label('sin_acceso')." </span>";
				break;

			case ($permissions>=1)	:

				$display_content  = false;

				$html_content  .= "<div class=\"tab_content css_rows_search_content\" $display_content >";

					# Search operators
					$html_content  .= "<div class=\"button_with_icon_left toggle_search_operators\">".label::get_label('operadores_de_busqueda')."</div>";


					# FORM
					$html_content  .= "<form class=\"css_rows_search_form\" id=\"search_form\" name=\"search_form\" method=\"POST\" action=\"\" onKeyPress=\"return search.check_submit(this, event)\">";

						# COMPONENTS ( CAMPOS DE BÃšSQUEDA )
						# dump($ar_search_fields, ' ar_search_fields ++ '.to_string());
						foreach($ar_search_fields as $key_search_component => $component_obj) {

							# Set always as accesible search components
							$component_obj->set_permissions(2);

							if(strpos($key_search_component, ':') !== false){
								$case_portal = explode(':', $key_search_component);
								$search_name = $case_portal[0].'_'.$component_obj->get_section_tipo() .'_' .$case_portal[1];

								$html_content  .="<div class=\"css_portal_title\">";
								$current_modelo_name = RecordObj_dd::get_modelo_name_by_tipo($case_portal[0],true);
								$component_portal =component_common::get_instance( $current_modelo_name,
																				   $case_portal[0],
																				   null,
																				   'edit',
																				   DEDALO_DATA_NOLAN,
																				   $section_tipo);
								$portal_name = $component_portal->get_label();
								$html_content  .=$portal_name;
								$html_content  .="</div>";

							}else{
								$search_name = $component_obj->get_section_tipo() .'_'. $component_obj->get_tipo();
							}
							$component_obj->set_search_input_name($search_name);
							$html_content .= $component_obj->get_html();
						}
						$html_content  .= " <hr>";

						# BUTTONS ACC SEARCH COMPONENTS (MAX PER PAGE,SEARCH BUTTON, RESET...)
						foreach($ar_tools_search as $current_tool_search) {
							$html_content .= $current_tool_search->get_html();
						}
						
						$html_content  .= "<input type=\"hidden\" name=\"section_tipo\" value=\"$section_tipo\">";
						$html_content  .= "<input type=\"hidden\" name=\"modo\" value=\"$modo\">";
						$html_content  .= "<input type=\"hidden\" name=\"search_options_session_key\" value=\"$search_options_session_key\">";
						$html_content  .= "<input type=\"hidden\" name=\"context\" value='".json_encode($context)."'>";

						if(SHOW_DEBUG===true) {
							$html_content  .= "<div class=\"debug_info\">";
							$html_content  .= "<div>search_options_session_key: $search_options_session_key</div> ";
							$html_content  .= "<div>context: ".json_encode($context)."</div>";
							$html_content  .= "</div>";
						}
						
					$html_content  .= "</form>";


				$html_content  .= "</div><!-- /css_rows_search_content -->";
				break;
		}
		*/


		# PRINT HTML
		print $html_content;


	print "</div><!-- /css_wrap_rows_search -->";
?>