"use strict";var search2=new function(){this.url_trigger=DEDALO_LIB_BASE_URL+"/search/trigger.search2.php",this.search_presets_section_tipo="dd623",this.search_layout_state,this.initied=!1,this.search_panel_is_open=!1,this.modo=null,window.ready(function(){!0===search2.cookie_track("search_panel")&&document.getElementById("open_search2_button").click()}),this.track_show_search_panel=function(e){var t="search_panel",o=readCookie(t)||"{}";return o=JSON.parse(o),"open"===e.action?o[e.section_tipo]=!0:o[e.section_tipo]=!1,createCookie(t,JSON.stringify(o),365),!0},this.hide_search_panel=function(){var e=this,t=document.getElementById("search2_global_container"),o,n=document.getElementById("search2_container_selection_presets").dataset.section_tipo;if("none"!==t.style.display){var a;if(t.style.display="none",e.track_show_search_panel({action:"close",section_tipo:n}),"thesaurus"===e.modo)document.getElementById("thesaurus_search_selector").style.display="none";e.search_panel_is_open=!1}else{var r;if(t.style.display="flex",e.track_show_search_panel({action:"open",section_tipo:n}),"thesaurus"===e.modo)document.getElementById("thesaurus_search_selector").style.display="block";e.search_panel_is_open=!0}return!1},this.init=function(e){var t=this;!0===SHOW_DEBUG&&console.log("!search2 initied with options:",e),t.modo=e.modo||"list";var o=e.section_tipo,n=document.getElementById("search2_global_container"),a=document.getElementById("search2_container_selector"),r=document.getElementById("search2_container_selection"),s=document.getElementById("search2_container_selection_presets");if(!0===search2.initied)return t.hide_search_panel(),!1;t.track_show_search_panel({action:"open",section_tipo:o}),t.load_components_from_section({target_div:a,section_tipo:o,ar_real_section_tipo:e.ar_real_section_tipo,path:[]});var _=t.get_component_presets({target_section_tipo:o}).then(function(){n.style.display="flex"});t.update_state({state:"unchanged"});var i=decodeURIComponent(e.temp_filter),c,l,d,p,m;if(10<i.length){var u=JSON.parse(i);!0===SHOW_DEBUG&&console.log("[search2.init] **** FILTER:",u),t.parse_json_query_obj_to_dom(null,u,{allow_duplicates:!0}),!0===SHOW_DEBUG&&console.log("[search2.init] Loaded from previous filter_obj:",u)}else _.then(function(){var e=t.load_default_preset();!0===SHOW_DEBUG&&(!0===e?console.log("[search2.init] Loaded default preset. ",e):console.log("[search2.init] Failed load default preset. No default preset found. ",e)),!1===e&&(t.build_search_group(document.getElementById("search_group_container"),{operator:"$and",is_root:!0}),!0===SHOW_DEBUG&&console.log("[search2.init] Created fallback root search_group (no previous options or presets found)"))});("true"===(readCookie("search_presets_open_panel")||"false")&&(s.style.display="block"),"true"===(readCookie("fields_open_panel")||"false")&&(a.style.display="flex"),"thesaurus"===t.modo)&&(document.getElementById("thesaurus_search_selector").style.display="block");return search2.initied=!0,t.search_panel_is_open=!0},this.get_limit=function(){var e=10,t=document.querySelector(".table_rows_list");if(null!==t){var o=t.dataset.search_options;if(1<o.length){o=decodeURIComponent(o);var n,a=JSON.parse(o).search_query_object;e=parseInt(a.limit)}else console.error("Empty search_options data.",t.dataset)}return e},this.update_state=function(e){!0===SHOW_DEBUG&&console.log("[search2.update_state] options:",e);var t=this;t.search_layout_state=e;var o=document.getElementById("search2_container_selection_presets"),n=document.getElementById("button_save_preset");"thesaurus"===t.modo&&n.classList.add("in_thesaurus"),e.editing_section_id&&(o.dataset.section_id=e.editing_section_id,o.dataset.save_arguments=e.editing_save_arguments);var a=o.dataset.section_id;if(n&&("changed"===e.state&&a?n.classList.add("show"):n.classList.remove("show")),"changed"===e.state){var r=o.dataset.section_tipo;t.save_temp_preset(r),!0===SHOW_DEBUG&&console.log("[search2.update_state] Saved tem preset of section: ",r)}return!0},this.load_components_from_section=function(t){var o=this,n;n=t.target_div?t.target_div:document.getElementById("search2_container_selector");var e=null,a={mode:"get_components_from_section",section_tipo:e=t.ar_real_section_tipo?t.ar_real_section_tipo:t.section_tipo},r;return html_page.loading_content(n,1),common.get_json_data(o.url_trigger,a).then(function(e){!0===SHOW_DEBUG&&e&&console.log("[search2.load_components_from_section] response:",e),e?o.build_components_list(e.result,n,t.path):console.error("[search2.load_components_from_section] Error. response is null",e),html_page.loading_content(n,0)},function(e){console.log("[search2.load_components_from_section] Error.",e),html_page.loading_content(n,0)})},this.build_components_list=function(d,p,m){for(var u=this;p.hasChildNodes();)p.removeChild(p.lastChild);if(void 0===d[0])return console.error("Error on build_components_list. Empty ar_components",d),!1;for(var h=common.create_dom_element({element_type:"div",class_name:"search_section_container",parent:p}),g=common.create_dom_element({element_type:"div",class_name:"search_section_container target_container",parent:p}),v,f,y,e=d.length,t=function e(t){var o=d[t],n;o.section_tipo!==y&&common.create_dom_element({element_type:"div",parent:h,class_name:"search_section_bar_label ",inner_html:o.section_label}).addEventListener("click",function(e){p.classList.contains("target_container")&&(p.innerHTML="")},!1);o.section_group_tipo!==v&&(f=common.create_dom_element({element_type:"ul",parent:h}),common.create_dom_element({element_type:"li",parent:f,class_name:"search_section_group_label",inner_html:o.section_group_label}));var a=void 0,r=u.calculate_component_path(o,m);switch(o.has_subquery){case!0:var s="search_component_label has_subquery",_=null,i=!1;"component_autocomplete"===o.modelo_name&&(_=[{type:"dragstart",name:"search2.on_dragstart"},{type:"dragend",name:"search2.on_drag_end"},{type:"drop",name:"search2.on_drop"}],s="search_component_label has_subquery element_draggable",i=!0),a=common.create_dom_element({element_type:"li",parent:f,class_name:s,inner_html:o.component_label,draggable:i,data_set:{path:JSON.stringify(r),modelo_name:o.modelo_name},custom_function_events:_});var c=o.target_section[0];a.addEventListener("click",function(e){u.load_components_from_section({section_tipo:c,target_div:g,path:r});for(var t=h.querySelectorAll("li.active"),o,n=t.length-1;0<=n;n--)t[n].classList.remove("active");this.classList.add("active")},!1);break;default:var l=[{type:"dragstart",name:"search2.on_dragstart"},{type:"dragend",name:"search2.on_drag_end"},{type:"drop",name:"search2.on_drop"}];a=common.create_dom_element({element_type:"li",parent:f,class_name:"search_component_label element_draggable",inner_html:o.component_label,draggable:!0,data_set:{path:JSON.stringify(r),modelo_name:o.modelo_name},custom_function_events:l})}!0===SHOW_DEBUG&&a.addEventListener("click",function(e){console.log("calculated_component_path:",r)},!1),v=o.section_group_tipo,y=o.section_tipo},o=0;o<e;o++)t(o);return window.scrollTo(0,0),!0},this.calculate_component_path=function(e,t){Array.isArray(t)||(console.log("[search2.calculate_component_path] Fixed bad path as array! :",t),t=[]);for(var o=[],n=t.length,a=0;a<n;a++)o.push(t[a]);return o.push({section_tipo:e.section_tipo,component_tipo:e.component_tipo,modelo:e.modelo_name,name:e.component_label}),o},this.get_component_presets=function(t){var o=this,n=document.getElementById("component_presets_list"),e={mode:"get_component_presets",target_section_tipo:t.target_section_tipo},a;return html_page.loading_content(n,1),common.get_json_data(o.url_trigger,e).then(function(e){!0===SHOW_DEBUG&&e&&console.log("[search2.get_component_presets] response:",e),e?o.build_component_presets_list(e.result,n,e.permissions,t.target_section_tipo):console.error("[search2.get_component_presets] Error. response is null",e),html_page.loading_content(n,0)},function(e){console.log("[search2.get_component_presets] Error.",e),html_page.loading_content(n,0)})},this.build_component_presets_list=function(e,t,o,n){for(var a=this;t.hasChildNodes();)t.removeChild(t.lastChild);if(void 0===e[0])return console.warn("[search2.build_component_presets_list] Warning. Empty ar_elements received",e),!1;for(var r,s=readCookie("search_presets")||"{}",_=(s=JSON.parse(s))[n]||!1,i=!1,c=e.length,l=0;l<c;l++){var d=e[l];i=!1===_?!0===d.default&&!1===i:_==d.section_id;var p=common.create_dom_element({element_type:"li",parent:t,class_name:!0===i?"selected":"",data_set:{section_id:d.section_id,json_preset:d.json_preset,save_arguments:d.save_arguments}}),m;common.create_dom_element({element_type:"span",parent:p,class_name:"icon_bs link component_presets_button_load"}).addEventListener("click",function(e){a.load_search_preset(this)},!1);var u=common.create_dom_element({element_type:"span",parent:p,text_content:d.name,class_name:"css_span_dato",data_set:{parent:d.section_id,section_tipo:"dd623",tipo:"dd624"}}),h;if(2<=o&&u.addEventListener("click",function(e){a.edit_preset(this)},!1),2<=o)common.create_dom_element({element_type:"span",parent:p,class_name:"icon_bs link component_presets_button_delete"}).addEventListener("click",function(e){a.delete_preset(this)},!1);var g=common.create_dom_element({element_type:"div",parent:p,class_name:"div_edit"})}return!0},this.load_default_preset=function(e){var t=this,o,n=document.getElementById("component_presets_list").querySelector("li.selected");if(n){var a=n.dataset.json_preset,r=n.dataset.section_id,s=n.dataset.save_arguments;return t.parse_json_query_obj_to_dom(null,JSON.parse(a),{allow_duplicates:!0}),t.update_state({state:"unchanged",editing_section_id:r,editing_save_arguments:s}),!0}return!1},this.on_dragstart=function(e,t){return t.stopPropagation(),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e.dataset.path),!0},this.on_dragenter=function(e,t){},this.on_dragover=function(e,t){t.preventDefault(),t.stopPropagation()},this.on_dragleave=function(e,t){},this.on_drop=function(e,t){t.preventDefault(),t.stopPropagation();var o=t.dataTransfer.getData("text/plain"),n=e;return search2.build_search_component(n,o),search2.update_state({state:"changed"}),!0},this.load_search_preset=function(e){var t=this,o=e.parentNode,n=JSON.parse(o.dataset.json_preset),a=o.dataset.section_id,r=JSON.parse(o.dataset.save_arguments);t.parse_json_query_obj_to_dom(e,n,{allow_duplicates:!0});var s,_=document.getElementById("search2_container_selection_presets").dataset.section_tipo,i="search_presets",c=readCookie(i)||"{}";(c=JSON.parse(c))[_]=a,createCookie(i,JSON.stringify(c),365);for(var l=o.parentNode.childNodes,d,p=l.length-1;0<=p;p--)l[p].classList.remove("selected");return o.classList.add("selected"),t.update_state({state:"unchanged",editing_section_id:a,editing_save_arguments:r}),!0},this.build_search_group=function(e,t){var o=this;if(void 0===t&&(t={operator:"$and",is_root:!1}),!0===t.is_root&&document.getElementById("root_search_group"))return!1;var n=o.calculate_search_group_counter(),a=[{type:"dragstart",name:"search2.on_dragstart"},{type:"dragend",name:"search2.on_drag_end"},{type:"drop",name:"search2.on_drop"},{type:"dragenter",name:"search2.on_dragenter"},{type:"dragover",name:"search2.on_dragover"},{type:"dragleave",name:"search2.on_dragleave"}],r=common.create_dom_element({element_type:"div",parent:e,class_name:"search_group",data_set:{id:n},custom_function_events:a,id:t.is_root?"root_search_group":null}),s,_,i;(common.create_dom_element({element_type:"div",parent:r,text_content:o.localize_operator(t.operator)+" ["+n+"]",data_set:{value:t.operator},class_name:"operator search_group_operator"+("$and"===t.operator?" and":" or")}).addEventListener("click",function(e){o.toggle_operator_value(this),o.update_state({state:"changed"})},!1),!1===t.is_root)&&common.create_dom_element({element_type:"span",parent:r,class_name:"button_close"}).addEventListener("click",function(e){o.remove_dom_component(r),o.update_state({state:"changed"})},!1);if(common.create_dom_element({element_type:"span",parent:r,class_name:"button_plus"}).addEventListener("click",function(e){o.add_search_group_to_dom(this,r),o.update_state({state:"changed"})},!1),!0===t.is_root){var c=document.getElementById("search_group_container"),l=common.create_dom_element({element_type:"div",parent:c,class_name:"max_group"}),d=common.create_dom_element({element_type:"span",parent:l,text_content:"max",class_name:"max_input_label"}),p=common.create_dom_element({element_type:"input",parent:l,value:o.get_limit(),class_name:"max_input"}),m=common.create_dom_element({element_type:"div",parent:c,class_name:"reset_group"}),u,h,g;common.create_dom_element({element_type:"button",parent:m,text_content:get_label.recargar,class_name:"btn btn-warning button_reset"}).addEventListener("click",function(e){o.reset()},!1),common.create_dom_element({element_type:"button",parent:m,text_content:get_label.mostrar_todos,class_name:"btn btn-warning button_reset button_show_all"}).addEventListener("click",function(e){o.show_all(this)},!1),common.create_dom_element({id:"button_submit",element_type:"button",parent:c,text_content:get_label.aplicar,class_name:"btn btn-success button_submit"}).addEventListener("click",function(e){o.search(this)},!1)}return r},this.build_search_component=function(e,t,o,n){var a=this,r=JSON.parse(t),s=r[r.length-1],_=r[0],i=common.create_dom_element({element_type:"div",parent:e,class_name:"search_component",data_set:{path:t},style:{display:"none"}}),c;return a.get_component_html({section_tipo:s.section_tipo,component_tipo:s.component_tipo,section_id:null,current_value:o,q_operator:n||null}).then(function(e){var t=e,o;if(i.innerHTML=t,exec_scripts_inside(i),common.create_dom_element({element_type:"span",parent:i,class_name:"button_close"}).addEventListener("click",function(e){a.remove_dom_component(i),a.update_state({state:"changed"})},!1),_!==s){var n=i.querySelector("span.label_add");n&&(n.innerHTML=_.name+" "+n.innerHTML)}component_common.update_component_with_value_state(i.querySelector("div.wrap_component")),$(i).fadeIn(250)})},this.get_component_html=function(n){var e=this,a={mode:"load_components",components:[{component_tipo:n.component_tipo,section_tipo:n.section_tipo,section_id:n.section_id,current_value:n.current_value,q_operator:n.q_operator,modo:"search"}]};return new Promise(function(o,t){common.get_json_data(e.url_trigger,a).then(function(e){var t;t=e?e.result:"Error on load component "+n.component_tipo,o(t)},function(e){console.log("[search2.get_component_html] Error.",e),t(Error("There was a network error. statusText:"+e))})})},this.remove_dom_component=function(e){e.parentNode.removeChild(e)},this.calculate_search_group_counter=function(){var e,t,o;return document.getElementById("search_group_container").querySelectorAll(".search_group").length+1},this.parse_dom_to_json_filter=function(e){var t=this,o={id:"temp",filter:{}},n=document.getElementById("root_search_group"),a=!0;!e.save_arguments||"true"!==e.save_arguments&&"false"!==e.save_arguments||(a=JSON.parse(e.save_arguments));var r="default";e.mode&&(r=e.mode);var s=this.recursive_groups(n,a,r);return!0===SHOW_DEBUG&&console.log("filter_obj: ",JSON.stringify(s)),o.filter=s,o},this.recursive_groups=function(e,t,o){var n=this,a=n.get_search_group_operator(e),r={};r[a]=[];for(var s=e.children,_=s.length,i=0;i<_;i++){var c=s[i];if(c.classList.contains("search_component")){var l=null,d=null;if(!1!==t){var p,m,u=[].slice.call(c.childNodes).filter(function(e){return"DIV"===e.nodeName})[0];if(u&&void 0!==u.dataset.dato&&(l=JSON.parse(u.dataset.dato),"search"===o)){var h=u.dataset.component_name;l="function"==typeof window[h].get_search_value_from_dato?window[h].get_search_value_from_dato(l):window.component_common.get_search_value_from_dato(l)}if(u&&u.dataset.q_operator)try{d=JSON.parse(u.dataset.q_operator)}catch(e){d=u.dataset.q_operator}}"search"===o?(l&&0<l.length&&"[]"!==l||d&&0<d.length)&&((!l||0===l.length||"[]"===l)&&d&&0<d.length&&(l="only_operator"),r[a].push({q:l,q_operator:d,path:JSON.parse(c.dataset.path)})):r[a].push({q:l,q_operator:d,path:JSON.parse(c.dataset.path)})}else c.classList.contains("search_group")&&r[a].push(n.recursive_groups(c,t,o))}return r},this.get_search_group_operator=function(e){for(var t="$and",o=e.children,n=o.length,a=0;a<n;a++)if(o[a].classList.contains("search_group_operator")){t=o[a].dataset.value;break}return t},this.parse_json_query_obj_to_dom=function(e,t,o){for(var n=this,a=document.getElementById("search_group_container");a.hasChildNodes();)a.removeChild(a.lastChild);var r=!(!o||!o.clean_q)&&o.clean_q,s=!(!o||!o.allow_duplicates)&&o.allow_duplicates;return this.ar_resolved_elements=[],n.build_dom_group(t,a,{is_root:!0,clean_q:r,allow_duplicates:s}),!0},this.ar_resolved_elements=[],this.build_dom_group=function(e,t,o){var n=this,a=null,r=!(!o||!o.allow_duplicates)&&o.allow_duplicates;for(var s in e)if("path"===s){var _=e.q,i=e.q_operator,c=JSON.stringify(e.path)+_;-1===n.ar_resolved_elements.indexOf(c)&&(!0===o.clean_q&&(i=_=""),n.build_search_component(t,JSON.stringify(e.path),_,i),!0!==r&&n.ar_resolved_elements.push(c))}else if(-1!==s.indexOf("$"))for(var l=e[s],d=n.build_search_group(t,{operator:s,is_root:!!o.is_root&&o.is_root}),p=l.length,m=0;m<p;m++){var u=l[m];o.is_root=!1,n.build_dom_group(u,d,o)}return a},this.add_search_group_to_dom=function(e,t){var o=this;return void 0===t&&(t=document.getElementById("search_group_container")),o.build_search_group(t),!0},this.toggle_operator_value=function(e){var t=this,o,n,a=e.innerHTML.split(" ")[1];return"$and"===e.dataset.value?(e.dataset.value="$or",e.innerHTML=t.localize_operator(e.dataset.value)+" "+a,e.classList.remove("and"),e.classList.add("or")):(e.dataset.value="$and",e.innerHTML=t.localize_operator(e.dataset.value)+" "+a,e.classList.remove("or"),e.classList.add("and")),!0},this.new_preset=function(e){var n=this;void 0===e&&(e=document.getElementById("button_new_preset"));var t=n.search_presets_section_tipo,o="tmp",a=document.getElementById("new_preset_div");if(0<a.innerHTML.length){for(;a.hasChildNodes();)a.removeChild(a.lastChild);return!(e.innerHTML="+")}e.innerHTML="x";for(var r,s=document.getElementById("search2_container_selection_presets").querySelectorAll(".div_edit"),_,i=s.length-1;0<=i;i--)for(;s[i].hasChildNodes();)s[i].removeChild(s[i].lastChild);var c={mode:"load_components",components:[{component_tipo:"dd624",section_tipo:t,section_id:o,modo:"edit",clean:!0},{component_tipo:"dd640",section_tipo:t,section_id:o,modo:"edit",clean:!0},{component_tipo:"dd641",section_tipo:t,section_id:o,modo:"edit",clean:!0},{component_tipo:"dd648",section_tipo:t,section_id:o,modo:"edit",clean:!0}]},l;return common.get_json_data(n.url_trigger,c).then(function(e){if(!0===SHOW_DEBUG&&console.log("response:",e),e){a.innerHTML=e.result,exec_scripts_inside(a);var t=(get_label.crear?get_label.crear:"Create")+" "+(get_label.nuevo?get_label.nuevo:"new"),o;common.create_dom_element({element_type:"button",parent:a,class_name:"btn btn-success",inner_html:t}).addEventListener("click",function(e){n.save_new_preset(this)},!1)}},function(e){console.log("[search2.new_preset] Error.",e),html_page.loading_content(wrap_div,0)})},this.save_new_preset=function(e){var t=this,o=e.parentNode.querySelector('input[type="text"]');if(o.value.length<1)return o.focus(),!(o.placeholder="Empty preset name !");var n=document.getElementById("search2_container_selection_presets"),a=n.dataset.section_tipo;return n.dataset.section_id=t.search_presets_section_tipo+"_"+DEDALO_SECTION_ID_TEMP,t.save_preset(e,{}).then(function(e){console.log("[search2.save_new_preset] response:",e),t.new_preset()}),!0},this.save_preset=function(n){var a=this,e=document.getElementById("search2_container_selection_presets"),r=e.dataset.section_tipo,t=e.dataset.section_id,o=e.dataset.save_arguments,s=a.parse_dom_to_json_filter({save_arguments:o}),_=e;html_page.loading_content(_,1);var i={mode:"save_preset",filter:s.filter,data_section_tipo:r,preset_section_id:t},c;return common.get_json_data(a.url_trigger,i).then(function(e){if(!0===SHOW_DEBUG&&console.log("save_preset response:",e),e&&!1!==e.result){var t="search_presets",o=readCookie(t)||"{}";(o=JSON.parse(o))[r]=e.result,createCookie(t,JSON.stringify(o),365),a.get_component_presets({target_section_tipo:r}),n.classList.remove("show")}html_page.loading_content(_,0)},function(e){console.log("[search2.save_preset] Error.",e),html_page.loading_content(_,0)})},this.delete_preset=function(e){var n=this;if(!confirm(get_label.seguro))return!1;var t,a=e.parentNode.dataset.section_id,o=document.getElementById("search2_container_selection_presets"),r=o.dataset.section_tipo,s=o;html_page.loading_content(s,1);var _={mode:"delete_preset",section_id:a},i;return common.get_json_data(n.url_trigger,_).then(function(e){if(!0===SHOW_DEBUG&&console.log("[search2.delete_preset] response:",e),e&&!1!==e.result){n.update_state({state:"unchanged",editing_section_id:null});var t="search_presets",o=readCookie(t)||"{}";(o=JSON.parse(o))[r]==a&&(delete o[r],createCookie(t,JSON.stringify(o),365)),n.get_component_presets({target_section_tipo:r})}html_page.loading_content(s,0)},function(e){console.log("[search2.delete_preset] Error.",e),html_page.loading_content(s,0)})},this.edit_preset=function(e){var a=this,r=e.parentNode,s=r.querySelector(".div_edit"),t={};if(1<s.innerHTML.length){for(;s.hasChildNodes();)s.removeChild(s.lastChild);return!1}for(var o,n=document.getElementById("search2_container_selection_presets").querySelectorAll(".div_edit"),_,i=n.length-1;0<=i;i--)for(;n[i].hasChildNodes();)n[i].removeChild(n[i].lastChild);var c=a.search_presets_section_tipo,l={mode:"load_components",components:[{component_tipo:"dd624",section_tipo:c,section_id:r.dataset.section_id,modo:"edit"},{component_tipo:"dd640",section_tipo:c,section_id:r.dataset.section_id,modo:"edit"},{component_tipo:"dd641",section_tipo:c,section_id:r.dataset.section_id,modo:"edit"},{component_tipo:"dd648",section_tipo:c,section_id:r.dataset.section_id,modo:"edit"}]},d;return common.get_json_data(a.url_trigger,l).then(function(e){if(e){s.innerHTML=e.result,exec_scripts_inside(s);for(var t,o=s.querySelector("div.wrap_component_dd648").querySelectorAll(".css_radio_button"),n=o.length-1;0<=n;n--)o[n].addEventListener("change",function(e){if(!0===this.checked){var t,o=!1;1==JSON.parse(this.value).section_id&&(o=!0),a.update_state({state:"changed",editing_section_id:r.dataset.section_id,editing_save_arguments:o}),r.dataset.save_arguments=o}})}},function(e){console.log("[search2.edit_preset] Error.",e),html_page.loading_content(wrap_div,0)})},this.toggle_fields=function(e){var t=document.getElementById("search2_container_selector"),o="fields_open_panel";return"flex"!==t.style.display?(t.style.display="flex",createCookie(o,"true",365)):(t.style.display="none",createCookie(o,"false",365)),!0},this.toggle_presets=function(e,t){var o=document.getElementById("search2_container_selection_presets"),n="search_presets_open_panel";return"block"===o.style.display?(o.style.display="none",createCookie(n,"false",365)):(o.style.display="block",createCookie(n,"true",365)),!0},this.clean_all_inputs=function(){var e=this,t=document.getElementById("search2_container_selection"),o=e.parse_dom_to_json_filter({});return e.parse_json_query_obj_to_dom(null,o.filter,{clean_q:!0,allow_duplicates:!0}),!0},this.reset=function(e){var t,o,n,a,r;return this.clean_all_inputs(),!0},this.show_all=function(e){var t=this;if("thesaurus"===t.modo)area_thesaurus.reset(e);else{var o=t.get_search_json_object();o.filter={$and:[]},t.search(e,o)}return!0},this.search=function(e,t){document.activeElement.blur();var o=this;if(void 0===t&&(t=o.get_search_json_object()),!t)return!0===SHOW_DEBUG&&console.warn("[search2.search] invalid search_json_object. ",JSON.stringify(t)),!1;!0===SHOW_DEBUG&&console.log("[search2.search] search_json_object \n",JSON.stringify(t));var n={},a,r=document.querySelector(".table_rows_list").dataset.search_options;return 1<r.length?(r=decodeURIComponent(r),(n=JSON.parse(r)).search_query_object=t):n={modo:"list",context:{context_name:"default"},search_query_object:t},"thesaurus"===o.modo?area_thesaurus.search(n,e).then(function(e){!0===SHOW_DEBUG&&console.log("[search2.search] end search ",o.modo,e)}):search.load_rows(n,e).then(function(e){!0===SHOW_DEBUG&&console.log("[search2.search] end load_rows response: ",o.modo,e)}),o.hide_search_panel(),!0},this.get_search_json_object=function(){var e=this,t={},o=this.parse_dom_to_json_filter({mode:"search"}),n=document.getElementById("search2_global_container"),a=decodeURIComponent(n.dataset.select_path),r=JSON.parse(a),s="list",_=n.querySelector(".max_input"),i=document.querySelector(".table_rows_list"),c=decodeURIComponent(i.dataset.search_options),l=JSON.parse(c).search_query_object,d=l.section_tipo;if("thesaurus"===e.modo){for(var p,m=document.getElementById("thesaurus_search_selector_ul").querySelectorAll("input"),u=[],h=m.length,g=0;g<h;g++)!0===m[g].checked&&u.push(m[g].value);if(u.length<1)return alert("Please select at least one section to search"),!1;d=u}return t={id:l.id,modo:s,parsed:!1,section_tipo:d,limit:parseInt(_.value)||10,offset:0,type:"search_json_object",full_count:"thesaurus"!==e.modo,order:!1,filter:o.filter,select:r}},this.save_temp_preset=function(e){var t=this,o,n={mode:"save_temp_preset",section_tipo:e,filter_obj:t.parse_dom_to_json_filter({}).filter};!0===SHOW_DEBUG&&console.log("[search2.save_temp_preset] trigger_vars:",n);var a=common.get_json_data(t.url_trigger,n).then(function(e){SHOW_DEBUG,e||console.error("[search2.save_temp_preset] Error. response is null",e)},function(e){console.log("[search2.save_temp_preset] Error.",e)});return!1},this.cookie_track=function(e){var t=document.getElementById("search2_container_selection_presets");if(t){var o=t.dataset.section_tipo,n=readCookie(e)||"{}",a;return(n=JSON.parse(n))[o]||!1}return!1},this.localize_operator=function(e){var t="",o=e=e.slice(1);"and"===e?o="y":"or"===e&&(o="o");var n=get_label[o];return n&&(t=n),t},this.search_from_enter_key=function(e){return!0===SHOW_DEBUG&&console.log("[search_from_enter_key] search_panel_is_open:",search2.search_panel_is_open),!0===search2.search_panel_is_open?e.click():this.hide_search_panel(),!0},this.filter_is_empty=function(e){var t,o;return t=e[Object.keys(e)[0]].length<1},this.show_sections_checkboxes=function(e,t){t=decodeURIComponent(t);var o=JSON.parse(t);if(!0===SHOW_DEBUG&&console.log("[show_sections_checkboxes] ar_data:",o),0===o.length)return!1;for(var n=document.getElementById("thesaurus_search_selector_ul");n.hasChildNodes();)n.removeChild(n.lastChild);var a=o[e],r;if(void 0===a)return!0===SHOW_DEBUG&&console.log("[show_sections_checkboxes] ar_items is undefined for ar_data:",o,e),!1;for(var s=a.length,_=0;_<s;_++){var i=a[_],c=common.create_dom_element({element_type:"li",parent:n}),l=common.create_dom_element({element_type:"input",parent:c,id:i.hierarchy_target_section_tipo,name:i.hierarchy_target_section_tipo,value:i.hierarchy_target_section_tipo}),d;l.type="checkbox",l.checked=!0,common.create_dom_element({element_type:"label",parent:c,text_content:i.hierarchy_target_section_name}).setAttribute("for",i.hierarchy_target_section_tipo)}return createCookie("selected_tipology",e,365),!0},this.init_tipology_selector=function(e){var t=document.getElementById("thesaurus_typology_selector"),o=readCookie("selected_tipology")||t.value;return t.value=o,this.show_sections_checkboxes(o,e.ar_data_string),!0}};
//# sourceMappingURL=search2-min.js.map