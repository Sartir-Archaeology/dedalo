<?php

	# VISUALIZADOR HTML	

	# ELEMENTOS
	if(!isset ($ar_css['css_wrap_autocomplete']))	$ar_css['css_wrap_autocomplete']='';

			
	
	print "\n<!-- COMPONENT_AUTOCOMPLETE [tipo:$tipo section_id:$parent] $label -->";
	print "\n<div class=\"css_wrap_autocomplete wrap_component {$ar_css['css_wrap_autocomplete']}\" id=\"{$id_wrapper}\"
	data-tipo=\"{$tipo}\"
	data-lang=\"{$lang}\"
	data-parent=\"{$parent}\"
	data-section_tipo=\"{$section_tipo}\"
	data-ar_target_section_tipo='{$ar_target_section_tipo_json}'
	data-tipo_to_search='{$tipo_to_search}'
	data-modo=\"{$modo}\"
	data-dato='{$dato_json}'
	data-component_name=\"{$component_name}\"
	data-component_info='{$component_info}'
	>";
	
	# ETIQUETA (LABEL)
	$html_label = component_common_draw::draw_label($this);
	
	# CONTENIDO (INPUT)
	$html_contenido = '';
	switch($permissions) {
			
		case 0	:	$html_contenido .= "";
					break;
						
		case 1	: 	$html_contenido .= $valor;
					break;						
		
		case ($permissions>=2)	:
				
					# VALOR . STRING RESOLVED TO SHOW
					$html_contenido .= "\n <ul class=\"css_autocomplete_valor\">";
					foreach ($ar_valor as $current_value => $value) {
						
						$current_value_obj  	= json_decode($current_value);
						$current_section_id 	= $current_value_obj->section_id;
						$current_section_tipo 	= $current_value_obj->section_tipo;

						$html_contenido .= "<li>";

						
						#
						# BTN DELETE
						if (!$in_time_machine) {
						$html_contenido .= "\n <div class=\"icon_bs link css_autocomplete_button_delete\"
						data-tipo=\"{$tipo}\"
						data-current_value='$current_value'
						data-id_wrapper=\"$id_wrapper\"
						title=\"$label $parent\"
						onclick=\"component_autocomplete.delete(this)\"></div>";
						}
						
						#
						# LABEL
						$html_contenido .= $value;
						
						#
						# BTN EDIT
						if (!$in_time_machine) {
						$url_edit = "?t=".$current_section_tipo.'&id='.$current_section_id.'&m=edit';	// To first section only onclick=\"window.open('$url_edit')\"
						$html_contenido .= "<a href=\"$url_edit\" target=\"_blank\" class=\"icon_bs link edit_autocomplete edit_autocomplete_row\"></a>";
						}

						if(SHOW_DEBUG) {
							#$html_contenido .= " <span class=\"notes\">$current_value</span>";
						}

						$html_contenido .= "</li>";

					}
					$html_contenido .= "</ul>";

					
					if (!$in_time_machine) {
				
						#
						# BTN EDIT WHOLE SECTION
						$url_edit = "?t=".reset($ar_target_section_tipo);	// To first section only  onclick=\"window.open('$url_edit')\"
						$html_contenido .= "<a href=\"$url_edit\" target=\"_blank\" class=\"icon_bs link edit_autocomplete\"></a>";


						#
						# BTN NEW ELEMENT
						$html_contenido .= "<div class=\"icon_bs link new_autocomplete\" data-target_section_tipo=\"".reset($ar_target_section_tipo)."\" onclick=\"component_autocomplete.new_element(this,'$id_wrapper')\"></div>";


						#
						# INPUT SEARCH FIELD
						$html_contenido .= "\n <input type=\"text\" class=\"css_autocomplete_search_field\" placeholder=\"".label::get_label('buscar')."...\"
							data-tipo='{$tipo}'
							data-section_tipo=\"{$section_tipo}\"
							data-parent='{$parent}'
							data-ar_target_section_tipo='{$ar_target_section_tipo_json}'					
							data-tipo_to_search='{$tipo_to_search}'
							onfocus=\"component_autocomplete.activate(this)\"
							/>";


						#
						# NEW_ELEMENT_CONTAINER ajax loads here
						$html_contenido .= "<div class=\"new_element_container\" data-type=\"new_element_container\"></div>";

						if(SHOW_DEBUG) {
							$html_contenido .= "<div class=\"notes\">target_section_tipo: ".implode(', ', $ar_target_section_tipo)."</div>";
							if (isset($propiedades->filtered_by)) {
								$html_contenido .= "<div class=\"notes\">filtered_by: ".json_encode($propiedades->filtered_by)."</div>";	// filtered_by
							}
							$html_contenido .= "<div class=\"notes\">".str_replace('},', '},<br>', $dato_json) ."</div>";												
						}
					}


					#
					# INPUT DATA HIDDEN					
					$html_contenido .= "\n <input type=\"text\" class=\"css_autocomplete_dato_hidden\"
						name=\"{$input_name}\"
						data-type=\"autocomplete_dato_hidden\"
						data-tipo=\"{$tipo}\"
						data-section_tipo=\"{$section_tipo}\"
						data-parent=\"{$parent}\"
						data-lang=\"{$lang}\"
						data-ar_target_section_tipo='{$ar_target_section_tipo_json}'
						data-dato_in_db='{$dato_json}'
						data-id_wrapper=\"$id_wrapper\"
						value='{$dato_json}'
						title=''
						disabled=\"disabled\"
						/>";
					

			if($permissions==3)
					
					$html_contenido .= "\n <span class=\"css_span_debugger\" id=\"debugger_{$tipo}\" >{$debugger}</span>";	
				
											
	}

	# Prepare content to show in page
	tools::prepare_content($html_contenido);
	
	
	# PRINT HTML
	print $html_label;
	print $html_contenido;
	
	if(SHOW_DEBUG) {
		if (isset($this->ar_list_of_values->debug)) {
			echo $this->ar_list_of_values->debug;
		}		
	}
	
	print "\n</div><!-- /css_wrap_component_autocomplete COMPONENT_AUTOCOMPLETE [tipo:$tipo section_id:$parent] $label -->\n\n"; //wrap
?>